{% extends "base.html" %}

{% block head %}

    {% block title %}
        <title>GitHubHealth: {{ user }}</title>
    {% endblock %}

    {% block styles %}
        {{ super() }}
    {% endblock %}

{% endblock %}

{% block body %}

    {% block navbar %}
    {% endblock %}

    {% block content %}
        <div class="user_content">
            <h1 style="text-align: center">
                <a href={{ user.url }}>
                    {{ user.name }}
                </a>
            </h1>
        </div>

        <div>
            {{ table|safe }}
        </div>

        <table>
        {% for plot in plots %}
            <tr><td>
                <div id="vis{{loop.index}}"></div>
            </td></tr>
        {% endfor %}
        </table>
        <div class="org_content">
            <h1 style="text-align: center">
                <a href={{ org.url }}>
                    {{ org.name }}
                </a>
            </h1>
        </div>
         <div id="error"></div>
        {{ super() }}
    {% endblock %}

    {% block scripts %}
        <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-lite@4.8.1"></script>
        <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
        {% for plot in plots %}
            <script>
                (function(vegaEmbed) {
                    var embedOpt = {"mode": "vega-lite"};
                    var spec = {{ plot | safe }};
                    function showError(el, error){
                        el.innerHTML = ('<div class="error" style="color:red;">'
                                        + '<p>JavaScript Error: ' + error.message + '</p>'
                                        + "<p>This usually means there's a typo in your chart specification. "
                                        + "See the javascript console for the full traceback.</p>"
                                        + '</div>');
                        throw error;
                    }
                    const el = document.getElementById('vis{{loop.index}}');
                    vegaEmbed("#vis{{loop.index}}", spec, embedOpt)
                    .catch(error => showError(el, error));
                })(vegaEmbed);
            </script>
        {% endfor %}

    {% endblock %}

{% endblock %}
